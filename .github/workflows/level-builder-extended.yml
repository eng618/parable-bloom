name: Level Builder â€” Extended Tests

on:
  workflow_dispatch:
    inputs:
      run_full:
        description: 'Run full test suite (may be slow)'
        required: false
        default: 'false'

jobs:
  extended-tests:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v6

      - name: Set up Go
        uses: actions/setup-go@v4
        with:
          go-version: '1.25'

      - name: Install Task
        uses: arduino/setup-task@v2

      - name: Run extended level-builder tests (resilience)
        run: |
          echo "Running extended level-builder tests..."
          task lb:test:extended
        env:
          GOCACHE: ${{ runner.tool_cache }}/go

      - name: Upload per-run stats (always)
        uses: actions/upload-artifact@v4
        with:
          name: level-builder-stats
          path: tools/level-builder/full_run/stats/**

      - name: Upload failing dumps on failure
        if: failure()
        uses: actions/upload-artifact@v4
        with:
          name: failing-dumps
          path: tools/level-builder/failing_dumps/**
