version: "3"

tasks:
  install:
    desc: Install Hugo extended edition via Go
    cmds:
      - CGO_ENABLED=1 go install -tags extended github.com/gohugoio/hugo@latest
    preconditions:
      - sh: command -v go >/dev/null 2>&1
        msg: "Go is not installed."

  serve:
    desc: Start Hugo development server
    dir: tools/hugo-site
    cmds:
      - hugo server -D
    preconditions:
      - sh: command -v hugo >/dev/null 2>&1
        msg: "Hugo is not installed."

  build:
    desc: Build Hugo site to public/
    dir: tools/hugo-site
    sources:
      - "content/**/*"
      - "layouts/**/*"
      - "static/**/*"
      - "hugo.toml"
    generates:
      - "public/**/*"
    cmds:
      - hugo --minify
    preconditions:
      - sh: command -v hugo >/dev/null 2>&1
        msg: "Hugo is not installed."

  new:
    desc: Create new content page (usage - task hugo:new PAGE=privacy)
    dir: tools/hugo-site
    cmds:
      - hugo new content "{{.PAGE}}.md"
    preconditions:
      - sh: command -v hugo >/dev/null 2>&1
        msg: "Hugo is not installed."

  lint:
    desc: Run Hugo site linting
    dir: tools/hugo-site
    cmds:
      - golangci-lint run

  lint:fix:
    desc: Fix Hugo site linting issues (where possible)
    dir: tools/hugo-site
    cmds:
      - golangci-lint run --fix

  format:
    desc: Show diff of Hugo site code formatting
    dir: tools/hugo-site
    cmds:
      - golangci-lint fmt --diff-colored

  format:fix:
    desc: Format Hugo site code
    dir: tools/hugo-site
    cmds:
      - golangci-lint fmt
