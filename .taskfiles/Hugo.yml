version: "3"

tasks:
  # -----------------------------------------------------------------------------
  # Tooling Management

  install:
    desc: Install Hugo extended edition via Go
    status:
      - command -v hugo >/dev/null 2>&1
    cmds:
      - CGO_ENABLED=1 go install -tags extended github.com/gohugoio/hugo@latest
    preconditions:
      - sh: command -v go >/dev/null 2>&1
        msg: "Go is not installed."

  get:
    desc: Set up Hugo environment (install tool and initialize themes)
    deps: [install]
    cmds:
      - git submodule update --init --recursive

  # -----------------------------------------------------------------------------
  # Development

  serve:
    desc: Start Hugo development server
    dir: apps/hugo-site
    deps: [build]
    cmds:
      - hugo server -D
    preconditions:
      - sh: command -v hugo >/dev/null 2>&1
        msg: "Hugo is not installed."

  # -----------------------------------------------------------------------------
  # Build

  build:
    desc: Build Hugo site to public/
    dir: apps/hugo-site
    sources:
      - "content/**/*"
      - "layouts/**/*"
      - "static/**/*"
      - "hugo.toml"
    generates:
      - "public/**/*"
    cmds:
      - hugo --minify
    preconditions:
      - sh: command -v hugo >/dev/null 2>&1
        msg: "Hugo is not installed."

  # -----------------------------------------------------------------------------
  # Content Creation

  new:
    desc: Create new content page (usage - task hugo:new PAGE=privacy)
    dir: apps/hugo-site
    cmds:
      - hugo new content "{{.PAGE}}.md"
    preconditions:
      - sh: command -v hugo >/dev/null 2>&1
        msg: "Hugo is not installed."
