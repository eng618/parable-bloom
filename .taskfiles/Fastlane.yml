version: "3"

tasks:
  # -----------------------------------------------------------------------------
  # Android Deployment

  android:deploy:
    desc: Deploy Android to Google Play (Internal Testing) via Fastlane
    dir: apps/parable-bloom/android
    cmds:
      - fastlane deploy
    preconditions:
      - sh: command -v fastlane >/dev/null 2>&1
        msg: "Fastlane is not installed."

  android:beta:
    desc: Deploy Android to Google Play Beta Track via Fastlane
    dir: apps/parable-bloom/android
    cmds:
      - fastlane beta
    preconditions:
      - sh: command -v fastlane >/dev/null 2>&1
        msg: "Fastlane is not installed."

  android:build:
    desc: Build Android release bundle via Fastlane (no upload)
    dir: apps/parable-bloom/android
    cmds:
      - fastlane build_release
    preconditions:
      - sh: command -v fastlane >/dev/null 2>&1
        msg: "Fastlane is not installed."

  android:validate:
    desc: Validate Android bundle and credentials
    dir: apps/parable-bloom/android
    cmds:
      - fastlane validate
    preconditions:
      - sh: command -v fastlane >/dev/null 2>&1
        msg: "Fastlane is not installed."

  # -----------------------------------------------------------------------------
  # iOS Deployment

  ios:beta:
    desc: Deploy iOS to TestFlight via Fastlane
    platforms: [darwin]
    dir: apps/parable-bloom/ios
    cmds:
      - fastlane beta
    preconditions:
      - sh: command -v fastlane >/dev/null 2>&1
        msg: "Fastlane is not installed."

  ios:release:
    desc: Deploy iOS to App Store via Fastlane
    platforms: [darwin]
    dir: apps/parable-bloom/ios
    cmds:
      - fastlane release
    preconditions:
      - sh: command -v fastlane >/dev/null 2>&1
        msg: "Fastlane is not installed."

  ios:build:
    desc: Build iOS IPA via Fastlane (no upload)
    platforms: [darwin]
    dir: apps/parable-bloom/ios
    cmds:
      - fastlane build_release
    preconditions:
      - sh: command -v fastlane >/dev/null 2>&1
        msg: "Fastlane is not installed."

  ios:validate:
    desc: Validate iOS credentials and configuration
    platforms: [darwin]
    dir: apps/parable-bloom/ios
    cmds:
      - fastlane validate
    preconditions:
      - sh: command -v fastlane >/dev/null 2>&1
        msg: "Fastlane is not installed."

  # -----------------------------------------------------------------------------
  # CI Support

  ios:setup:
    desc: Setup iOS keychain for CI
    platforms: [darwin]
    dir: apps/parable-bloom/ios
    cmds:
      - fastlane setup_keychain
    preconditions:
      - sh: command -v fastlane >/dev/null 2>&1
        msg: "Fastlane is not installed."

  ios:cleanup:
    desc: Clean up iOS CI artifacts
    platforms: [darwin]
    dir: apps/parable-bloom/ios
    cmds:
      - fastlane cleanup
    preconditions:
      - sh: command -v fastlane >/dev/null 2>&1
        msg: "Fastlane is not installed."
